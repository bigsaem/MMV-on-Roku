<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2016 Roku Corp.  All Rights Reserved. -->
<component name="GetEpisodes" extends="Task">
  <interface>
    <field id = "contenturi" type = "string" />
    <field id = "seasonUrl" type = "string" />
    <field id = "seasonCount" type = "integer" />
    <field id = "result2" type = "roArray" />
    
    
    <field id = "content" type = "assocarray" />
  </interface>
  <script type="text/brightscript">
    
  <![CDATA[
  
  	sub init()
  		m.top.functionName = "getAPIResponse"
  	end sub
  	
  	sub getAPIResponse()  	
  	
  	print m.top.seasonCount
  		port = CreateObject("roMessagePort")
    	req = CreateObject("roUrlTransfer")
    	req.setRequest("GET")
    	req.setURL(m.top.seasonUrl)
    	'req.setURL(m.top.contenturi)    	
    	req.AddHeader("auth", "KPBR41wti28eGnLvVuQikPnPOVpv2TCk")
    	jsonTaskString = req.GetToString()
    	jsonTaskParsed = ParseJson(jsonTaskString)
    	
    	
    	    	    	
     	for each season in jsonTaskParsed._embedded.items
        	episodesAPI = season._links.episodes.href
        	
        	'call req here
        	'getString here
        	'parse here
        	'loop parsedObject here        	
    	end for
    	
    	
    	req.setUrl(episodesAPI)
    	print episodesAPI
    	jsonTaskString = req.GetToString()
    	jsonTaskParsed = ParseJson(jsonTaskString)
    	print type(jsonTaskParsed)
    	m.top.content = jsonTaskParsed    	
    	
    	
  	end sub
  ]]> 
  </script>
</component>
